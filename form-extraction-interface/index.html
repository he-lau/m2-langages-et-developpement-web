<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>
    <!-- ChartJS --->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Bootstrap --->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Font awesome --->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Style ---> 
    <link rel="stylesheet" href="css/style.css" />
    <!-- Model de notre app ---> 
    <script src="js/App.js"></script>
</head>
<body>

    <div id="main-container" class="container">
        <div id="main-row" class="row justify-content-center">
            <!-- Les cartes seront générées ici -->
        </div>
        
    </div>

</body>
</html>


<script>
    // DOM chargé
    document.addEventListener('DOMContentLoaded', function () {

        console.log('ready');

        //
        const _main_container = document.getElementById('main-container');
        const _main_row = document.getElementById('main-row');

        const _url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS6VwtY1UmsEVtVwGX0KX2iQcbiMZo5kms3hsHRizsZSGuuWG9G9HD5FjCRJG2JMOYpiaVVuTNLu2zK/pub?gid=178537300&single=true&output=csv";

        //
        var _app = new App();

        _app.setCsvUrl(_url);

        //var _data = await _app.csvToArray();
        //console.log(_app.getDatas()); 

        _app.csvToArray()
        .then(datas => {
            console.log('Datas:', datas);


            // commence par l'indice 1 car 0 correspond aux noms
            for (let i = 1; i < datas.length; i++) {
                    // courant
                    const data = datas[i];
                    // div pour chaque tuple
                    const card = document.createElement("div");

                    card.className = "col-lg-4 col-md-12";
                    card.innerHTML = `
                    <div class="card" style="width: 18rem;">
                        <div class="user-chart">
                            <div class="card-header">
                                <h1>#${i} ${data[1]}</h1>
                            </div>
                            <img class="card-img-top" src="${_app.transformGoogleDriveUrl(data[2])}" alt="Card image cap">
                            <div class="card-body"></div>
                            <canvas class="radar-chart" width="400" height="400"></canvas>
                        </div>
                    </div>
                `;

                _main_row.appendChild(card);

                /*
                    Radar chart avec ChartJS
                */ 

                // paramètres

                // dom element
                const ctx = card.querySelector(".radar-chart").getContext("2d");
                const labels = ["HTML", "CSS", "JavaScript", "TypeScript", "PHP"];
                const skillLevels = data.slice(3).map(Number);

                const radarChart = new Chart(ctx, {
                    type: "radar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Niveaux de compétences",
                            data: data,
                            backgroundColor: "rgba(75, 192, 192, 0.2)",
                            borderColor: "rgba(75, 192, 192, 1)",
                            borderWidth: 2
                        }]
                    },
                    options: {
                        scale: {
                            ticks: {
                                beginAtZero: true,
                                stepSize: 1,
                                min: 0,
                                max: 5
                            }
                        }
                    }
                });                

                }
        })
        .catch((error) => {
            console.error('Error:', error);
        });
        
        

    });
</script>
